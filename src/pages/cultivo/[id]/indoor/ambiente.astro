---
import Layout from '../../../../layouts/Layout.astro';
import { supabase } from '../../../../lib/supabase';
import { authenticate } from '../../../../lib/auth';
import AmbienteLogs from '../../../../components/cultivos/indoor/AmbienteLogs';
import AmbientePlanner from '../../../../components/cultivos/indoor/AmbientePlanner';   

const { id } = Astro.params;

const { user, redirect } = await authenticate(Astro);
if (redirect) {
    return Astro.redirect(redirect);
}

const user_id = user?.id;

const { data: cultivo} = await supabase
  .from('cultivos')
  .select('config')
  .eq('id', id)
  .eq('uuid', user_id)
  .single();

const { data: ambiente} = await supabase
  .from('cultivos')
  .select('ambiente')
  .eq('id', id)
  .eq('uuid', user_id)
  .single();



const { data: strains, error } = await supabase
  .from('cultivos')
  .select('strains')
  .eq('cultivo_id', id)
  .eq('uuid', user_id);

const config = cultivo?.config;
const ambiente_logs = ambiente?.ambiente?.logs;

---

<Layout title="Cultivo" description="Cultivo">
    <div class="container mx-auto p-4">
        <h1 class="text-2xl font-bold mb-6">AMBIENTE</h1>
        <AmbientePlanner client:load cultivoId={id} ambiente={ambiente}/>
        <AmbienteLogs client:load cultivoId={id} user_id={user_id} ambiente_logs={ambiente_logs} />
    </div>
</Layout>


